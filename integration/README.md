# APEX SWE Harness - Integration Testing

[![CI](https://github.com/your-org/apex-swe-harness/workflows/CI/badge.svg)](https://github.com/your-org/apex-swe-harness/actions)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)

A modular, production-grade harness for running integration tests to evaluate AI models on software engineering tasks.

## Features

- **Unified Interface**: Single CLI replaces 8+ duplicated scripts
- **Model Registry**: Easy addition of new AI models via configuration
- **Parallel Execution**: Run tasks concurrently for faster results
- **Progress Tracking**: Real-time CSV status tracking
- **Docker Integration**: Automatic cleanup of Docker resources
- **Comprehensive Testing**: Full test suite ensures reliability
- **Type-Safe**: Modern Python with type hints throughout

## Quick Start

### Installation

```bash
# From the integration directory
cd integration

# Install package
pip install -e .

# Or install with development dependencies
pip install -e ".[dev]"
```

### Basic Usage

```bash
# Run all tasks with Claude
apex-runner --model claude

# Run specific tasks with Gemini in parallel
apex-runner --model gemini --tasks task1 task2 --parallel --max-workers 5

# Dry run to preview commands
apex-runner --model xai --dry-run

# Custom tasks directory and artifacts location
apex-runner --model opus --tasks-dir ./tasks --artifacts-dir ./results
```

## Supported Models

| Model | Provider | Identifier |
|-------|----------|------------|
| Claude Sonnet 4.5 | Anthropic | `claude` |
| Claude Opus 4 | Anthropic | `opus` |
| Gemini 3 Pro | Google | `gemini` |
| Grok 4 | xAI | `xai` |
| DeepSeek V3.2 | Fireworks | `deepseek` |
| Qwen 3 Coder | Fireworks | `qwen` |
| Codex | OpenAI | `codex` |
| Kimi | Moonshot | `kimi` |

## Project Structure

```
integration/
├── src/apex_harness/      # Main package
│   ├── cli.py             # Command-line interface
│   ├── models.py          # Model registry
│   ├── runner.py          # Execution orchestration
│   ├── task_executor.py   # Task execution
│   ├── status_tracker.py  # Progress tracking
│   ├── task_discovery.py  # Task scanning
│   ├── docker_utils.py    # Docker management
│   └── reporting.py       # Result reporting
├── tests/                 # Test suite
├── tasks/                 # Task definitions
├── docs/                  # Documentation
├── examples/              # Usage examples
├── scripts/               # Helper scripts
└── artifacts/             # Generated outputs (gitignored)
```

## Environment Variables

Some models require API keys:

```bash
# For Fireworks-based models (DeepSeek, Qwen)
export FIREWORKS_API_KEY='your-api-key'

# Other models use their respective authentication methods
```

## Examples

### Sequential Execution

```bash
apex-runner --model claude --tasks task1 task2 task3
```

### Parallel Execution

```bash
apex-runner --model gemini --parallel --max-workers 5
```

### Custom Configuration

```bash
apex-runner \
  --model xai \
  --tasks-dir ./tasks \
  --artifacts-dir ./results \
  --status-csv ./status.csv \
  --parallel \
  --max-workers 3
```

## Development

### Setup Development Environment

```bash
cd integration
pip install -e ".[dev]"

# Run tests
pytest tests/

# Format code
black src/ tests/

# Lint code
ruff check src/ tests/

# Type check
mypy src/
```

### Running Tests

```bash
# All tests
pytest tests/

# With coverage
pytest tests/ --cov=apex_harness --cov-report=term

# Only unit tests
pytest tests/ -m "not integration"
```

## Architecture

The harness uses clean design patterns for maintainability and extensibility:

- **Strategy Pattern**: Model selection and execution strategy
- **Factory Pattern**: Task and executor creation
- **Dependency Injection**: Flexible configuration and testing

See [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md) for detailed design documentation.

## Adding a New Model

1. Add configuration to `src/apex_harness/models.py`:
   ```python
   "new-model": ModelConfig(
       name="New Model Name",
       identifier="api-model-identifier",
       report_prefix="newmodel",
       status_csv_prefix="newmodel",
       n_trials=3,
       max_workers=3,
       timeout=3600,
   ),
   ```

2. Test the configuration:
   ```bash
   apex-runner --model new-model --dry-run
   ```

3. Add tests and update documentation

See [CONTRIBUTING.md](CONTRIBUTING.md) for detailed guidelines.

## Output Files

All generated artifacts are stored in `artifacts/` (configurable):

- `{model}_tasks_status_{timestamp}.csv` - Execution status tracking
- Reports generated by `apx` tool (location depends on tool configuration)

## Documentation

- **Quick Start**: [QUICKSTART.md](QUICKSTART.md)
- **Architecture**: [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md)
- **Migration Guide**: [docs/MIGRATION.md](docs/MIGRATION.md)
- **Testing Guide**: [docs/TESTING.md](docs/TESTING.md)
- **Contributing**: [CONTRIBUTING.md](CONTRIBUTING.md)
- **Security**: [SECURITY.md](SECURITY.md)

## License

This project is licensed under the MIT License - see [LICENSE](LICENSE) file for details.

## Support

- **Issues**: [GitHub Issues](https://github.com/your-org/apex-swe-harness/issues)
- **Documentation**: [docs/](docs/)

## Acknowledgments

Built with modern Python best practices for production-grade integration testing.
